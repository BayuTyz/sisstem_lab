<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <title>Data Pasien - MediLab</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container">
        <a class="navbar-brand" href="/dashboard"
          ><i class="fas fa-flask"></i> MediLab</a
        >
        <div class="navbar-nav">
          <a class="nav-link" href="/dashboard">Dashboard</a>
          <a class="nav-link active" href="/pasien">Pasien</a>
          <a class="nav-link" href="/input-pemeriksaan">Pemeriksaan</a>
          <a class="nav-link" href="/logout">Logout</a>
        </div>
      </div>
    </nav>

    <div class="container mt-4">
      <h3>Data Pasien</h3>
      <button
        class="btn btn-primary mb-3"
        data-bs-toggle="modal"
        data-bs-target="#addModal"
      >
        <i class="fas fa-plus"></i> Tambah Pasien
      </button>

      <table id="patientsTable" class="table table-striped">
        <thead>
          <tr>
            <th>ID Pasien</th>
            <th>Nama Lengkap</th>
            <th>Gender</th>
            <th>Tanggal Lahir</th>
            <th>Telepon</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody>
          <!-- Data akan diisi oleh JavaScript -->
        </tbody>
      </table>
    </div>

    <!-- Modal Tambah Pasien -->
    <div class="modal fade" id="addModal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Tambah Pasien Baru</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="addPatientForm">
              <div class="mb-3">
                <label>ID Pasien</label>
                <input
                  type="text"
                  class="form-control"
                  name="patient_id"
                  required
                />
              </div>
              <div class="mb-3">
                <label>Nama Lengkap</label>
                <input
                  type="text"
                  class="form-control"
                  name="full_name"
                  required
                />
              </div>
              <div class="mb-3">
                <label>Jenis Kelamin</label>
                <select class="form-select" name="gender" required>
                  <option value="Laki-laki">Laki-laki</option>
                  <option value="Perempuan">Perempuan</option>
                </select>
              </div>
              <div class="mb-3">
                <label>Tanggal Lahir</label>
                <input
                  type="date"
                  class="form-control"
                  name="birth_date"
                  required
                />
              </div>
              <div class="mb-3">
                <label>Telepon</label>
                <input type="text" class="form-control" name="phone" />
              </div>
              <div class="mb-3">
                <label>Alamat</label>
                <textarea class="form-control" name="address"></textarea>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Batal
            </button>
            <button
              type="button"
              class="btn btn-primary"
              onclick="savePatient()"
            >
              Simpan
            </button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

    <script>
      // Load data pasien
      function loadPatients() {
        $.ajax({
          url: "/api/pasien",
          method: "GET",
          success: function (data) {
            let table = $("#patientsTable").DataTable();
            table.clear();
            data.forEach(function (patient) {
              table.row.add([
                patient.patient_id,
                patient.full_name,
                patient.gender,
                patient.birth_date,
                patient.phone,
                `<button class="btn btn-sm btn-warning" onclick="editPatient(${patient.id})">Edit</button>
                             <button class="btn btn-sm btn-danger" onclick="deletePatient(${patient.id})">Hapus</button>`,
              ]);
            });
            table.draw();
          },
        });
      }

      // Tambah pasien
      function savePatient() {
        let formData = {
          patient_id: $('[name="patient_id"]').val(),
          full_name: $('[name="full_name"]').val(),
          gender: $('[name="gender"]').val(),
          birth_date: $('[name="birth_date"]').val(),
          phone: $('[name="phone"]').val(),
          address: $('[name="address"]').val(),
          email: "",
        };

        $.ajax({
          url: "/api/pasien",
          method: "POST",
          contentType: "application/json",
          data: JSON.stringify(formData),
          success: function (response) {
            alert(response.message);
            $("#addModal").modal("hide");
            loadPatients();
          },
        });
      }

      // Hapus pasien
      function deletePatient(id) {
        if (confirm("Apakah Anda yakin ingin menghapus pasien ini?")) {
          $.ajax({
            url: `/api/pasien/delete/${id}`,
            method: "POST",
            success: function (response) {
              alert(response.message);
              loadPatients();
            },
          });
        }
      }

      // Edit pasien (implementasi sederhana)
      function editPatient(id) {
        alert("Fitur edit untuk pasien ID: " + id);
      }

      // Load data saat halaman dimuat
      $(document).ready(function () {
        $("#patientsTable").DataTable();
        loadPatients();
      });
    </script>
  </body>
</html>
